<launch>
    <arg name="velocity_control" default="false"/>
    <arg name="sim" default="true"/>

    <rosparam file="$(find carmen_control)/config/common/state_controller.yml" command="load" ns="/"/>

    <group if="$(arg sim)">
        <rosparam file="$(find carmen_control)/config/gazebo/gazebo_controller.yml" command="load" ns="/"/>
        <group if="$(arg velocity_control)">
            <rosparam file="$(find carmen_control)/config/common/velocity_controllers.yml" command="load" ns="/"/>
            <node name="controller_spawner" pkg="controller_manager" type="spawner" respawn="false" output="screen" ns="/"
                  args="joint_state_controller front_right_wheel_velocity_controller front_left_wheel_velocity_controller rear_right_wheel_velocity_controller rear_left_wheel_velocity_controller"/>
        </group>
        <group unless="$(arg velocity_control)">
            <rosparam file="$(find carmen_control)/config/gazebo/four_wheel_controller.yml" command="load" ns="/"/>
            <node name="controller_spawner" pkg="controller_manager" type="spawner" respawn="false" output="screen" ns="/"
                  args="joint_state_controller four_wheel_controller"/>
        </group>
    </group>

    <group unless="$(arg sim)">
        <group if="$(arg velocity_control)">
            <rosparam file="$(find carmen_control)/config/common/velocity_controllers.yml" command="load" ns="/"/>
            <node name="controller_spawner" pkg="controller_manager" type="spawner" respawn="false" output="screen" ns="/"
                  args="joint_state_controller front_right_wheel_velocity_controller front_left_wheel_velocity_controller rear_right_wheel_velocity_controller rear_left_wheel_velocity_controller"/>
        </group>
        <group unless="$(arg velocity_control)">
            <rosparam file="$(find carmen_control)/config/hardware/four_wheel_controller.yml" command="load" ns="/"/>
            <node name="controller_spawner" pkg="controller_manager" type="spawner" respawn="false" output="screen" ns="/"
                  args="joint_state_controller four_wheel_controller"/>
        </group>
    </group>

    <node pkg="twist_mux" type="twist_mux" name="twist_mux" unless="$(arg velocity_control)">
        <rosparam command="load" file="$(find carmen_control)/config/common/twist_mux.yml"/>
        <remap from="cmd_vel_out" to="/four_wheel_controller/cmd_vel"/>
    </node>
</launch>